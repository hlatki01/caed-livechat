{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/widget.js","webpack:///../src/index.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","log","window","RocketChat","_","widget","iframe","scrollPosition","widget_height","all","config","hookQueue","ready","smallScreen","validCallbacks","callbacks","Map","on","type","handler","handlers","push","set","off","splice","indexOf","emit","evt","slice","map","registerCallback","eventName","fn","emitCallback","data","callHook","action","params","src","args","contentWindow","postMessage","updateWidgetStyle","isOpened","document","documentElement","scrollTop","body","classList","add","remove","style","left","height","width","WIDGET_MARGIN","openWidget","dataset","state","focus","closeWidget","api","popup","length","forEach","hookParams","apply","this","minimizeWindow","restoreWindow","closed","close","openPopout","open","url","lastIndexOf","resizeWidget","removeWidget","removeChild","callback","showWidget","display","hideWidget","resetDocumentStyle","setFullScreenDocumentMobile","pageVisited","change","location","JSON","parse","stringify","title","setCustomField","overwrite","setTheme","theme","setDepartment","department","setBusinessUnit","businessUnit","setGuestToken","token","setGuestName","setGuestEmail","email","registerGuest","guest","setAgent","agent","setLanguage","language","currentPage","href","init","createElement","className","position","maxHeight","bottom","right","zIndex","container","id","allowTransparency","border","backgroundColor","appendChild","handleMediaQueryTest","matches","mediaQueryList","matchMedia","addListener","createWidget","addEventListener","msg","undefined","concat","setInterval","initRocket","console","warn","queue","livechat","initialize","method","Array","isArray","clearDepartment","maximizeWidget","minimizeWidget","clearBusinessUnit","onChatMaximized","onChatMinimized","onChatStarted","onChatEnded","onPrechatFormSubmit","onOfflineFormSubmit","onWidgetShown","onWidgetHidden","onAssignAgent","onAgentStatusChange","onQueuePositionChange","onServiceOffline"],"mappings":"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","file":"rocketchat-livechat.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"livechat/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","import mitt from 'mitt';\r\n\r\n\r\nconst log = process.env.NODE_ENV === 'development'\r\n\t? (...args) => window.console.log('%cwidget%c', 'color: red', 'color: initial', ...args)\r\n\t: () => {};\r\n\r\n\r\nconst WIDGET_OPEN_WIDTH = 365;\r\nconst WIDGET_OPEN_HEIGHT = 525;\r\nconst WIDGET_MINIMIZED_WIDTH = 54;\r\nconst WIDGET_MINIMIZED_HEIGHT = 54;\r\nconst WIDGET_MARGIN = 16;\r\n\r\n\r\nwindow.RocketChat = window.RocketChat || { _: [] };\r\nconst config = {};\r\nlet widget;\r\nlet iframe;\r\nlet hookQueue = [];\r\nlet ready = false;\r\nlet smallScreen = false;\r\nlet scrollPosition;\r\nlet widget_height;\r\n\r\nexport const validCallbacks = [\r\n\t'chat-maximized',\r\n\t'chat-minimized',\r\n\t'chat-started',\r\n\t'chat-ended',\r\n\t'pre-chat-form-submit',\r\n\t'offline-form-submit',\r\n\t'show-widget',\r\n\t'hide-widget',\r\n\t'assign-agent',\r\n\t'agent-status-change',\r\n\t'queue-position-change',\r\n\t'no-agent-online',\r\n];\r\n\r\nconst callbacks = mitt();\r\n\r\nfunction registerCallback(eventName, fn) {\r\n\tif (validCallbacks.indexOf(eventName) === -1) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn callbacks.on(eventName, fn);\r\n}\r\n\r\nfunction emitCallback(eventName, data) {\r\n\tif (typeof data !== 'undefined') {\r\n\t\tcallbacks.emit(eventName, data);\r\n\t} else {\r\n\t\tcallbacks.emit(eventName);\r\n\t}\r\n}\r\n\r\n// hooks\r\nfunction callHook(action, params) {\r\n\tif (!ready) {\r\n\t\treturn hookQueue.push([action, params]);\r\n\t}\r\n\tconst data = {\r\n\t\tsrc: 'rocketchat',\r\n\t\tfn: action,\r\n\t\targs: params,\r\n\t};\r\n\tiframe.contentWindow.postMessage(data, '*');\r\n}\r\n\r\nconst updateWidgetStyle = (isOpened) => {\r\n\tif (smallScreen && isOpened) {\r\n\t\tscrollPosition = document.documentElement.scrollTop;\r\n\t\tdocument.body.classList.add('rc-livechat-mobile-full-screen');\r\n\t} else {\r\n\t\tdocument.body.classList.remove('rc-livechat-mobile-full-screen');\r\n\t\tif (smallScreen) {\r\n\t\t\tdocument.documentElement.scrollTop = scrollPosition;\r\n\t\t}\r\n\t}\r\n\r\n\tif (isOpened) {\r\n\t\twidget.style.left = smallScreen ? '0' : 'auto';\r\n\r\n\t\t/**\r\n\t\t * If we use widget.style.height = smallScreen ? '100vh' : ...\r\n\t\t * In above case some browser's viewport height is not rendered correctly\r\n\t\t * so, as 100vh will resolve to 100% of the current viewport height,\r\n\t\t * so fixed it to 100% avoiding problem for some browsers. Similar resolution\r\n\t\t * for widget.style.width\r\n\t\t */\r\n\r\n\t\twidget.style.height = smallScreen ? '100%' : `${ WIDGET_MARGIN + widget_height + WIDGET_MARGIN + WIDGET_MINIMIZED_HEIGHT }px`;\r\n\t\twidget.style.width = smallScreen ? '100%' : `${ WIDGET_MARGIN + WIDGET_OPEN_WIDTH + WIDGET_MARGIN }px`;\r\n\t} else {\r\n\t\twidget.style.left = 'auto';\r\n\t\twidget.style.width = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_WIDTH + WIDGET_MARGIN }px`;\r\n\t\twidget.style.height = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_HEIGHT + WIDGET_MARGIN }px`;\r\n\t}\r\n};\r\n\r\nconst createWidget = (url) => {\r\n\twidget = document.createElement('div');\r\n\twidget.className = 'rocketchat-widget';\r\n\twidget.style.position = 'fixed';\r\n\twidget.style.width = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_WIDTH + WIDGET_MARGIN }px`;\r\n\twidget.style.height = `${ WIDGET_MARGIN + WIDGET_MINIMIZED_HEIGHT + WIDGET_MARGIN }px`;\r\n\twidget.style.maxHeight = '100vh';\r\n\twidget.style.bottom = '0';\r\n\twidget.style.right = '0';\r\n\twidget.style.zIndex = '12345';\r\n\twidget.dataset.state = 'closed';\r\n\r\n\tconst container = document.createElement('div');\r\n\tcontainer.className = 'rocketchat-container';\r\n\tcontainer.style.width = '100%';\r\n\tcontainer.style.height = '100%';\r\n\r\n\tiframe = document.createElement('iframe');\r\n\tiframe.id = 'rocketchat-iframe';\r\n\tiframe.allowTransparency = 'true';\r\n\tiframe.src = url;\r\n\tiframe.style.width = '100%';\r\n\tiframe.style.height = '100%';\r\n\tiframe.style.border = 'none';\r\n\tiframe.style.backgroundColor = 'transparent';\r\n\r\n\tcontainer.appendChild(iframe);\r\n\twidget.appendChild(container);\r\n\tdocument.body.appendChild(widget);\r\n\r\n\tconst handleMediaQueryTest = ({ matches }) => {\r\n\t\tif (!widget) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsmallScreen = matches;\r\n\t\tupdateWidgetStyle(widget.dataset.state === 'opened');\r\n\t\tcallHook('setExpanded', smallScreen);\r\n\t};\r\n\r\n\tconst mediaQueryList = window.matchMedia('screen and (max-device-width: 480px)');\r\n\tmediaQueryList.addListener(handleMediaQueryTest);\r\n\thandleMediaQueryTest(mediaQueryList);\r\n};\r\n\r\nconst openWidget = () => {\r\n\tif (widget.dataset.state === 'opened') {\r\n\t\treturn;\r\n\t}\r\n\r\n\twidget_height = WIDGET_OPEN_HEIGHT;\r\n\tupdateWidgetStyle(true);\r\n\twidget.dataset.state = 'opened';\r\n\tiframe.focus();\r\n\temitCallback('chat-maximized');\r\n};\r\n\r\nconst resizeWidget = (height) => {\r\n\twidget_height = height;\r\n\tupdateWidgetStyle(true);\r\n\twidget.dataset.state = 'triggered';\r\n};\r\n\r\nfunction closeWidget() {\r\n\tif (widget.dataset.state === 'closed') {\r\n\t\treturn;\r\n\t}\r\n\r\n\tupdateWidgetStyle(false);\r\n\twidget.dataset.state = 'closed';\r\n\temitCallback('chat-minimized');\r\n}\r\n\r\nconst api = {\r\n\tpopup: null,\r\n\r\n\tready() {\r\n\t\tready = true;\r\n\t\tif (hookQueue.length > 0) {\r\n\t\t\thookQueue.forEach(function(hookParams) {\r\n\t\t\t\tcallHook.apply(this, hookParams);\r\n\t\t\t});\r\n\t\t\thookQueue = [];\r\n\t\t}\r\n\t},\r\n\r\n\tminimizeWindow() {\r\n\t\tcloseWidget();\r\n\t},\r\n\r\n\trestoreWindow() {\r\n\t\tif (api.popup && api.popup.closed !== true) {\r\n\t\t\tapi.popup.close();\r\n\t\t\tapi.popup = null;\r\n\t\t}\r\n\t\topenWidget();\r\n\t},\r\n\r\n\topenPopout() {\r\n\t\tcloseWidget();\r\n\t\tapi.popup = window.open(`${ config.url }${ config.url.lastIndexOf('?') > -1 ? '&' : '?' }mode=popout`,\r\n\t\t\t'livechat-popout', `width=${ WIDGET_OPEN_WIDTH }, height=${ widget_height }, toolbars=no`);\r\n\t\tapi.popup.focus();\r\n\t},\r\n\r\n\topenWidget() {\r\n\t\topenWidget();\r\n\t},\r\n\r\n\tresizeWidget(height) {\r\n\t\tresizeWidget(height);\r\n\t},\r\n\r\n\tremoveWidget() {\r\n\t\tdocument.body.removeChild(widget);\r\n\t},\r\n\r\n\tcallback(eventName, data) {\r\n\t\temitCallback(eventName, data);\r\n\t},\r\n\r\n\tshowWidget() {\r\n\t\tiframe.style.display = 'initial';\r\n\t\temitCallback('show-widget');\r\n\t},\r\n\r\n\thideWidget() {\r\n\t\tiframe.style.display = 'none';\r\n\t\temitCallback('hide-widget');\r\n\t},\r\n\r\n\tresetDocumentStyle() {\r\n\t\tdocument.body.classList.remove('rc-livechat-mobile-full-screen');\r\n\t},\r\n\r\n\tsetFullScreenDocumentMobile() {\r\n\t\tsmallScreen && document.body.classList.add('rc-livechat-mobile-full-screen');\r\n\t},\r\n};\r\n\r\nfunction pageVisited(change) {\r\n\tcallHook('pageVisited', {\r\n\t\tchange,\r\n\t\tlocation: JSON.parse(JSON.stringify(document.location)),\r\n\t\ttitle: document.title,\r\n\t});\r\n}\r\n\r\nfunction setCustomField(key, value, overwrite) {\r\n\tif (typeof overwrite === 'undefined') {\r\n\t\toverwrite = true;\r\n\t}\r\n\tcallHook('setCustomField', [key, value, overwrite]);\r\n}\r\n\r\nfunction setTheme(theme) {\r\n\tcallHook('setTheme', theme);\r\n}\r\n\r\nfunction setDepartment(department) {\r\n\tcallHook('setDepartment', department);\r\n}\r\n\r\nfunction setBusinessUnit(businessUnit) {\r\n\tcallHook('setBusinessUnit', businessUnit);\r\n}\r\n\r\nfunction clearBusinessUnit() {\r\n\tcallHook('clearBusinessUnit');\r\n}\r\n\r\nfunction setGuestToken(token) {\r\n\tcallHook('setGuestToken', token);\r\n}\r\n\r\nfunction setGuestName(name) {\r\n\tcallHook('setGuestName', name);\r\n}\r\n\r\nfunction setGuestEmail(email) {\r\n\tcallHook('setGuestEmail', email);\r\n}\r\n\r\nfunction registerGuest(guest) {\r\n\tcallHook('registerGuest', guest);\r\n}\r\n\r\nfunction clearDepartment() {\r\n\tcallHook('clearDepartment');\r\n}\r\n\r\nfunction setAgent(agent) {\r\n\tcallHook('setAgent', agent);\r\n}\r\n\r\nfunction setLanguage(language) {\r\n\tcallHook('setLanguage', language);\r\n}\r\n\r\nfunction showWidget() {\r\n\tcallHook('showWidget');\r\n}\r\n\r\nfunction hideWidget() {\r\n\tcallHook('hideWidget');\r\n}\r\n\r\nfunction maximizeWidget() {\r\n\tcallHook('maximizeWidget');\r\n}\r\n\r\nfunction minimizeWidget() {\r\n\tcallHook('minimizeWidget');\r\n}\r\n\r\nfunction initialize(params) {\r\n\tfor (const method in params) {\r\n\t\tif (!params.hasOwnProperty(method)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tswitch (method) {\r\n\t\t\tcase 'customField':\r\n\t\t\t\tconst { key, value, overwrite } = params[method];\r\n\t\t\t\tsetCustomField(key, value, overwrite);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'setCustomFields':\r\n\t\t\t\tif (!Array.isArray(params[method])) {\r\n\t\t\t\t\tconsole.log('Error: Invalid parameters. Value must be an array of objects');\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tparams[method].forEach((data) => {\r\n\t\t\t\t\tconst { key, value, overwrite } = data;\r\n\t\t\t\t\tsetCustomField(key, value, overwrite);\r\n\t\t\t\t});\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'theme':\r\n\t\t\t\tsetTheme(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'department':\r\n\t\t\t\tsetDepartment(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'businessUnit': {\r\n\t\t\t\tsetBusinessUnit(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tcase 'guestToken':\r\n\t\t\t\tsetGuestToken(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'guestName':\r\n\t\t\t\tsetGuestName(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'guestEmail':\r\n\t\t\t\tsetGuestEmail(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'registerGuest':\r\n\t\t\t\tregisterGuest(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'language':\r\n\t\t\t\tsetLanguage(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tcase 'agent':\r\n\t\t\t\tsetAgent(params[method]);\r\n\t\t\t\tcontinue;\r\n\t\t\tdefault:\r\n\t\t\t\tcontinue;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst currentPage = {\r\n\thref: null,\r\n\ttitle: null,\r\n};\r\n\r\nconst attachMessageListener = () => {\r\n\twindow.addEventListener('message', (msg) => {\r\n\t\tif (typeof msg.data === 'object' && msg.data.src !== undefined && msg.data.src === 'rocketchat') {\r\n\t\t\tif (api[msg.data.fn] !== undefined && typeof api[msg.data.fn] === 'function') {\r\n\t\t\t\tconst args = [].concat(msg.data.args || []);\r\n\t\t\t\tlog(`api.${ msg.data.fn }`, ...args);\r\n\t\t\t\tapi[msg.data.fn].apply(null, args);\r\n\t\t\t}\r\n\t\t}\r\n\t}, false);\r\n};\r\n\r\nconst trackNavigation = () => {\r\n\tsetInterval(() => {\r\n\t\tif (document.location.href !== currentPage.href) {\r\n\t\t\tpageVisited('url');\r\n\t\t\tcurrentPage.href = document.location.href;\r\n\t\t}\r\n\r\n\t\tif (document.title !== currentPage.title) {\r\n\t\t\tpageVisited('title');\r\n\t\t\tcurrentPage.title = document.title;\r\n\t\t}\r\n\t}, 800);\r\n};\r\n\r\nconst init = (url) => {\r\n\tif (!url) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconfig.url = url;\r\n\r\n\tcreateWidget(url);\r\n\tattachMessageListener();\r\n\ttrackNavigation();\r\n};\r\n\r\nif (typeof window.initRocket !== 'undefined') {\r\n\tconsole.warn('initRocket is now deprecated. Please update the livechat code.');\r\n\tinit(window.initRocket[0]);\r\n}\r\n\r\nif (typeof window.RocketChat.url !== 'undefined') {\r\n\tinit(window.RocketChat.url);\r\n}\r\n\r\nconst queue = window.RocketChat._;\r\n\r\nwindow.RocketChat._.push = function(c) {\r\n\tc.call(window.RocketChat.livechat);\r\n};\r\nwindow.RocketChat = window.RocketChat._.push;\r\n\r\n// exports\r\nwindow.RocketChat.livechat = {\r\n\t// methods\r\n\tpageVisited,\r\n\tsetCustomField,\r\n\tinitialize,\r\n\tsetTheme,\r\n\tsetDepartment,\r\n\tclearDepartment,\r\n\tsetGuestToken,\r\n\tsetGuestName,\r\n\tsetGuestEmail,\r\n\tsetAgent,\r\n\tregisterGuest,\r\n\tsetLanguage,\r\n\tshowWidget,\r\n\thideWidget,\r\n\tmaximizeWidget,\r\n\tminimizeWidget,\r\n\tsetBusinessUnit,\r\n\tclearBusinessUnit,\r\n\r\n\t// callbacks\r\n\tonChatMaximized(fn) { registerCallback('chat-maximized', fn); },\r\n\tonChatMinimized(fn) { registerCallback('chat-minimized', fn); },\r\n\tonChatStarted(fn) { registerCallback('chat-started', fn); },\r\n\tonChatEnded(fn) { registerCallback('chat-ended', fn); },\r\n\tonPrechatFormSubmit(fn) { registerCallback('pre-chat-form-submit', fn); },\r\n\tonOfflineFormSubmit(fn) { registerCallback('offline-form-submit', fn); },\r\n\tonWidgetShown(fn) { registerCallback('show-widget', fn); },\r\n\tonWidgetHidden(fn) { registerCallback('hide-widget', fn); },\r\n\tonAssignAgent(fn) { registerCallback('assign-agent', fn); },\r\n\tonAgentStatusChange(fn) { registerCallback('agent-status-change', fn); },\r\n\tonQueuePositionChange(fn) { registerCallback('queue-position-change', fn); },\r\n\tonServiceOffline(fn) { registerCallback('no-agent-online', fn); },\r\n};\r\n\r\n// proccess queue\r\nqueue.forEach((c) => {\r\n\tc.call(window.RocketChat.livechat);\r\n});\r\n","export type EventType = string | symbol;\n\n// An event handler can take an optional event argument\n// and should not return a value\nexport type Handler<T = any> = (event?: T) => void;\nexport type WildcardHandler = (type: EventType, event?: any) => void;\n\n// An array of all currently registered event handlers for a type\nexport type EventHandlerList = Array<Handler>;\nexport type WildCardEventHandlerList = Array<WildcardHandler>;\n\n// A map of event types and their corresponding event handlers.\nexport type EventHandlerMap = Map<EventType, EventHandlerList | WildCardEventHandlerList>;\n\nexport interface Emitter {\n\tall: EventHandlerMap;\n\n\ton<T = any>(type: EventType, handler: Handler<T>): void;\n\ton(type: '*', handler: WildcardHandler): void;\n\n\toff<T = any>(type: EventType, handler: Handler<T>): void;\n\toff(type: '*', handler: WildcardHandler): void;\n\n\temit<T = any>(type: EventType, event?: T): void;\n\temit(type: '*', event?: any): void;\n}\n\n/**\n * Mitt: Tiny (~200b) functional event emitter / pubsub.\n * @name mitt\n * @returns {Mitt}\n */\nexport default function mitt(all?: EventHandlerMap): Emitter {\n\tall = all || new Map();\n\n\treturn {\n\n\t\t/**\n\t\t * A Map of event names to registered handler functions.\n\t\t */\n\t\tall,\n\n\t\t/**\n\t\t * Register an event handler for the given type.\n\t\t * @param {string|symbol} type Type of event to listen for, or `\"*\"` for all events\n\t\t * @param {Function} handler Function to call in response to given event\n\t\t * @memberOf mitt\n\t\t */\n\t\ton<T = any>(type: EventType, handler: Handler<T>) {\n\t\t\tconst handlers = all.get(type);\n\t\t\tconst added = handlers && handlers.push(handler);\n\t\t\tif (!added) {\n\t\t\t\tall.set(type, [handler]);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Remove an event handler for the given type.\n\t\t * @param {string|symbol} type Type of event to unregister `handler` from, or `\"*\"`\n\t\t * @param {Function} handler Handler function to remove\n\t\t * @memberOf mitt\n\t\t */\n\t\toff<T = any>(type: EventType, handler: Handler<T>) {\n\t\t\tconst handlers = all.get(type);\n\t\t\tif (handlers) {\n\t\t\t\thandlers.splice(handlers.indexOf(handler) >>> 0, 1);\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Invoke all handlers for the given type.\n\t\t * If present, `\"*\"` handlers are invoked after type-matched handlers.\n\t\t *\n\t\t * Note: Manually firing \"*\" handlers is not supported.\n\t\t *\n\t\t * @param {string|symbol} type The event type to invoke\n\t\t * @param {Any} [evt] Any value (object is recommended and powerful), passed to each handler\n\t\t * @memberOf mitt\n\t\t */\n\t\temit<T = any>(type: EventType, evt: T) {\n\t\t\t((all.get(type) || []) as EventHandlerList).slice().map((handler) => { handler(evt); });\n\t\t\t((all.get('*') || []) as WildCardEventHandlerList).slice().map((handler) => { handler(type, evt); });\n\t\t}\n\t};\n}\n"],"sourceRoot":""}